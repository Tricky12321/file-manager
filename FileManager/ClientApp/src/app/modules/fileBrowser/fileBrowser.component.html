<h1>File dashboard ({{ this.filePath }})</h1>
@if (this.loading) {
  <i class="fa fa-spinner fa-spin fa-3x fa-fw"></i>
}

<div class="row">
  <div class="col-9">
    @if (!this.loading) {
      <div class="row">
        <div class="col-3">
          <div class="form-group">
            <label for="hardlinks">Hardlinks</label>
            <select id="hardlinks" class="form-select" [(ngModel)]="hardlinkFilter" (change)="paramsChanged()">
              <option [value]="null">All</option>
              <option [value]="true">Only hardlinks</option>
              <option [value]="false">No hardlinks</option>
            </select>
          </div>
        </div>
        <div class="col-3">
          <div class="form-group">
            <label for="inQbit">In Qbit</label>
            <select id="inQbit" class="form-select" [(ngModel)]="inQbitFilter" (change)="paramsChanged()">
              <option [value]="null">All</option>
              <option [value]="true">Only in Qbit</option>
              <option [value]="false">Not in Qbit</option>
            </select>
          </div>
        </div>
        <div class="col-3">
          <div class="form-group">
            <label for="inQbitFolder">In Qbit Folder</label>
            <select id="inQbitFolder" class="form-select" [(ngModel)]="folderInQbitFilter" (change)="paramsChanged()">
              <option [value]="null">All</option>
              <option [value]="true">In folder</option>
              <option [value]="false">Not in folder</option>
            </select>
          </div>
        </div>
        <div class="col-3">
          <div class="form-group">
            <label for="needConfirm">Need Confirmation before delete</label>
            <input type="checkbox" id="needConfirm" class="form-check-input" [(ngModel)]="this.needConfirm" (change)="paramsChanged()" />
          </div>
          <div>
            <button class="btn btn-primary ms-2" (click)="deleteSelectedFiles()">Delete selected files</button>
            <button class="btn btn-secondary ms-2" (click)="toggleSelectedFiles()">Toggle selected files</button>
          </div>
        </div>
      </div>
    }
  </div>
  <div class="col-3">
    <button class="btn btn-secondary mt-4" (click)="this.load(true)">Refresh data</button>
  </div>
</div>
@if (this.fileList != null && !this.loading) {
  <table datatable [dtOptions]="dtOptions" class="table table-bordered table-striped table-hover modern-table">
    <thead>
    <tr>
      <th></th>
      <th>Path</th>
      <th>Size</th>
      <th>Hardlink</th>
      <th>In Qbit</th>
      <th>Folder in Qbit</th>
      <th></th>
    </tr>
    </thead>
    <tbody>
      @for (fileInfo of fileList; track fileInfo.path) {
        <tr>
          <td>
            <input type="checkbox" [(ngModel)]="fileInfo.selected" />
          </td>
          <td>{{ fileInfo.path }}</td>
          <td
            [attr.data-sort]="fileInfo.size">{{ fileInfo.sizeGb > 1 ? fileInfo.sizeGb + " GB" : fileInfo.sizeMb + " MB" }}
          </td>
          <td [attr.data-sort]="fileInfo.isHardlink">
            <i class="fa" [class.text-success]="!fileInfo.isHardlink" [class.fa-times]="!fileInfo.isHardlink"
               [class.text-danger]="fileInfo.isHardlink" [class.fa-check]="fileInfo.isHardlink"></i>
          </td>
          <td>
            <i class="fa" [class.text-danger]="!fileInfo.inQbit" [class.fa-times]="!fileInfo.inQbit"
               [class.text-success]="fileInfo.inQbit" [class.fa-check]="fileInfo.inQbit"></i>
          </td>
          <td>
            <i class="fa" [class.text-danger]="!fileInfo.folderInQbit" [class.fa-times]="!fileInfo.folderInQbit"
               [class.text-success]="fileInfo.folderInQbit" [class.fa-check]="fileInfo.folderInQbit"></i>
          </td>
          <td>
            <button class="btn btn-danger" (click)="deleteFile(fileInfo)">Delete</button>
          </td>
        </tr>
      }
    </tbody>
  </table>
}
